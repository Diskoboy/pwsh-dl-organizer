# Organize Downloads v0.2 — документация

## Отличия от v1

| Возможность | v1 | v0.2 |
|-------------|----|------|
| Целевая папка | Только «Загрузки» (на месте) | Любая (в т.ч. другой диск, напр. `E:\Temponary\.Downloads`) |
| Дубликаты | Нет | По хешу (SHA256), дубли → `_Duplicates` |
| Автоочистка | Нет | Старые установщики (>N дней) → `_Quarantine` |
| Конфигурация | Только в скрипте | Все настройки в скрипте (блок SETTINGS) + параметры командной строки |
| Логирование | Нет | Файл `organize.log` в целевой папке |
| Dry-run | Нет | Есть (`-DryRun`) |

---

## Параметры запуска

| Параметр | Тип | Описание |
|----------|-----|----------|
| `SourcePath` | string | Переопределить исходную папку (опционально). |
| `TargetPath` | string | Переопределить целевую папку (опционально). |
| `DryRun` | switch | Только показать, что будет сделано; файлы не переносить. |
| `SkipDuplicates` | switch | Не искать дубликаты по хешу. |
| `SkipAutoClean` | switch | Не перемещать старые установщики в `_Quarantine`. |

### Примеры

```powershell
# Стандартный запуск (из конфига или дефолты)
.\organize_downloads_v0.2.ps1

# Указать целевой диск
.\organize_downloads_v0.2.ps1 -TargetPath "E:\Temponary\.Downloads"

# Другой источник и цель
.\organize_downloads_v0.2.ps1 -SourcePath "C:\Users\Me\Downloads" -TargetPath "D:\Sorted"

# Переопределить путь из скрипта
.\organize_downloads_v0.2.ps1 -TargetPath "D:\Sorted"

# Только посмотреть, ничего не переносить
.\organize_downloads_v0.2.ps1 -DryRun

# Без поиска дубликатов и без автоочистки
.\organize_downloads_v0.2.ps1 -SkipDuplicates -SkipAutoClean
```

---

## Настройки в скрипте (блок SETTINGS)

Все настройки задаются в начале `organize_downloads_v0.2.ps1` в блоке `========== SETTINGS ==========`:

| Переменная | Описание |
|------------|----------|
| `$script:DefaultSource` | Исходная папка (по умолчанию: `%USERPROFILE%\Downloads`). |
| `$script:DefaultTarget` | Целевая папка (напр. `E:\Temponary\.Downloads`). |
| `$script:OldInstallerDays` | Возраст в днях: установщики старше этого срока переносятся в `_Quarantine`. |
| `$script:ChatExportPattern` | Регулярное выражение для имён .md-файлов в `chat_export`. |
| `$script:Folders` | Хеш «папка → массив расширений». |

Скрипт самодостаточен: один файл, внешние конфиги не нужны.

---

## Структура на целевом диске

```
E:\Temponary\.Downloads\
├── Installers\
├── Images\
├── Videos\
├── Audio\
├── Archives\
├── Documents\
├── chat_export\
├── Other\
├── _Quarantine\    # старые установщики (перед удалением)
├── _Duplicates\    # найденные дубликаты по хешу
└── organize.log    # лог операций
```

---

## Дубликаты

- **Определение:** совпадение содержимого файла (хеш SHA256). Сначала группировка по размеру, затем хеш только у файлов с одинаковым размером.
- **Поведение:** первый файл с данным содержимым остаётся в своей категории; все остальные копии перемещаются в `_Duplicates` для ручного разбора.
- Отключить поиск дубликатов: `-SkipDuplicates`.

---

## Автоочистка

- **Что:** файлы в целевой папке `Installers\`, старше `OldInstallerDays` дней (по дате изменения).
- **Куда:** перемещаются в `_Quarantine` (удаление не выполняется).
- Отключить: `-SkipAutoClean`.

---

## Логирование

- Файл: `organize.log` в **целевой** папке.
- Формат строки: `[дата время] [уровень] сообщение`.
- Пишутся: старт/завершение, переносы по категориям, дубликаты, автоочистка, ошибки.

---

## Безопасность

- Перезапись не выполняется: при совпадении имени в папке назначения добавляется суффикс `_1`, `_2`, …
- Удаление только через ручную очистку `_Quarantine` после проверки.
- Dry-run: `-DryRun` — только логи и вывод, без переноса и создания папок (папки для DryRun не создаются, в лог пишется «DRY-RUN»).
