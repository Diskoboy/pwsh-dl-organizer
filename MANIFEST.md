# Манифест проекта: Organize Downloads

## 1. Общие сведения

| Поле | Значение |
|------|----------|
| **Название** | Organize Downloads |
| **Тип** | Утилита (PowerShell-скрипт) |
| **Назначение** | Автоматическая сортировка файлов в папке «Загрузки» по типам (расширениям) |
| **Основной файл** | `organize_downloads.ps1` |
| **Платформа** | Windows (PowerShell 5.x / PowerShell Core) |
| **Язык** | PowerShell |

---

## 2. Цели проекта

- Разгрузить корень папки «Загрузки» от большого количества разнородных файлов.
- Разложить файлы по категориям без ручного перетаскивания.
- Сохранить все файлы (без перезаписи): при совпадении имён добавляется суффикс `_1`, `_2` и т.д.
- Корректно обрабатывать имена с кириллицей за счёт установки кодировки UTF-8.

---

## 3. Требования к среде

- **ОС:** Windows (проверялось на Windows 10/11).
- **PowerShell:** встроенный Windows PowerShell или PowerShell 7+.
- **Права:** чтение и запись в целевую папку (по умолчанию `C:\Users\<User>\Downloads`).
- **Зависимости:** сторонние модули не используются.

---

## 4. Структура проекта

```
organize-downloads/
├── organize_downloads.ps1   # основной исполняемый скрипт
├── MANIFEST.md             # манифест проекта (подробная документация)
└── README.md               # краткое описание и запуск
```

---

## 5. Конфигурация

### 5.1. Целевая папка

В скрипте жёстко задана базовая папка:

```powershell
$base = "C:\Users\Darkover\Downloads"
```

Чтобы сортировать другую папку, нужно изменить эту переменную в начале скрипта.

### 5.2. Категории и расширения

Соответствие «папка → расширения» задаётся хешем `$folders`:

| Папка | Расширения |
|-------|------------|
| **Installers** | `.exe`, `.msi` |
| **Images** | `.png`, `.jpg`, `.jpeg`, `.gif`, `.webp`, `.bmp`, `.ico` |
| **Videos** | `.mp4`, `.mkv`, `.avi`, `.mov`, `.wmv`, `.webm` |
| **Archives** | `.zip`, `.7z`, `.rar`, `.tar`, `.gz` |
| **Documents** | `.txt`, `.xlsx`, `.xls`, `.pdf`, `.docx`, `.doc`, `.md` |
| **Other** | все остальные расширения (в т.ч. без расширения) |

Добавление новой категории: добавить запись в `$folders` и при необходимости доработать цикл переноса (логика уже поддерживает произвольный набор пар «папка — массив расширений»).

---

## 6. Алгоритм работы

1. **Кодировка**  
   Устанавливаются `$OutputEncoding` и `[Console]::OutputEncoding` в UTF-8 для корректной работы с кириллическими именами.

2. **Создание папок**  
   Для каждой ключа из `$folders` создаётся подпапка в `$base`, если её ещё нет.

3. **Сбор файлов**  
   В `$base` получаются все объекты типа «файл»; `desktop.ini` исключается. Вложенные папки не обходятся — обрабатывается только корень `$base`.

4. **Классификация и перенос**  
   Для каждого файла:
   - берётся расширение (в нижнем регистре);
   - по нему определяется категория из `$folders`;
   - если расширение никуда не подошло — файл относится в **Other**;
   - целевой путь: `$base\<Категория>\<Имя файла>`;
   - если такой файл уже существует, к имени без расширения добавляется `_1`, `_2`, … до появления свободного имени;
   - перенос выполняется через `Move-Item -LiteralPath ... -Force` (перезапись отключена за счёт уникального имени).

5. **Завершение**  
   В консоль выводится сообщение о созданных папках.

**Важно:** существующие подпапки в «Загрузках» (например, `Telegram Desktop`, `gsd`) скрипт не перемещает и не изменяет — переносятся только файлы, лежащие непосредственно в `$base`.

---

## 7. Запуск

### 7.1. Из консоли PowerShell

```powershell
cd organize-downloads
.\organize_downloads.ps1
```

Если включена политика выполнения, требующая подпись скриптов:

```powershell
powershell -ExecutionPolicy Bypass -File "organize-downloads\organize_downloads.ps1"
```

(Путь указывать относительно текущего каталога или полный путь к папке проекта.)

### 7.2. Планировщик заданий Windows

Можно создать задачу, которая запускает скрипт по расписанию (например, раз в день), указав в действии:

- Программа: `powershell.exe`
- Аргументы: `-ExecutionPolicy Bypass -File "<полный_путь>\organize-downloads\organize_downloads.ps1"`

---

## 8. Безопасность и ограничения

- **Перезапись:** не выполняется; при совпадении имени генерируется новое с суффиксом.
- **Откат:** встроенного отката нет; при необходимости восстановить порядок нужно делать бэкап папки «Загрузки» до запуска.
- **Права:** скрипт не запрашивает повышенных прав; достаточно прав пользователя на папку.
- **Символьные ссылки и junction:** обрабатываются как обычные файлы/каталоги; при необходимости их можно исключить отдельной проверкой.
- **Ошибки:** при сбое `Move-Item` используется `-ErrorAction SilentlyContinue`, поэтому скрипт не падает, но ошибка не выводится; для отладки можно заменить на `-ErrorAction Stop` или логировать.

---

## 9. Результат выполнения (пример)

После первого запуска в `C:\Users\Darkover\Downloads` появляются (или остаются) папки:

- `Installers` — установщики
- `Videos` — видео
- `Documents` — документы и таблицы
- `Images` — изображения
- `Archives` — архивы
- `Other` — прочее

Уже существующие каталоги (например, с мессенджеров или расширений браузера) остаются на месте. Повторный запуск при пустом корне «Загрузок» просто создаёт/проверяет папки и завершается без переносов.

---

## 10. Возможные доработки

- Параметризация целевой папки и списка категорий через аргументы или конфиг-файл.
- Логирование перенесённых файлов (имя, откуда, куда) в текстовый лог.
- Опция «только показать, что будет перенесено» (dry-run) без реального перемещения.
- Рекурсивная обработка вложенных папок (с опцией и риском дублирования структуры).
- Исключение из переноса определённых имён или расширений (белый/чёрный список).

---

## 11. История изменений (кратко)

- Первая версия: создание скрипта, шесть категорий, защита от перезаписи через суффиксы имён.
- Добавлена установка UTF-8 в начале скрипта для корректной работы с кириллицей.
- Манифест проекта добавлен для документирования назначения, конфигурации и использования.
- Проект вынесен в отдельную папку `organize-downloads`, добавлен README.

---

*Документ: манифест проекта Organize Downloads. Файл: `MANIFEST.md`.*
