# Манифест проекта: Organize Downloads

## 1. Общие сведения

| Поле | Значение |
|------|----------|
| **Название** | Organize Downloads |
| **Тип** | Утилита (PowerShell-скрипт) |
| **Назначение** | Автоматическая сортировка файлов в папке «Загрузки» по типам и правилам (расширения, особые имена) |
| **Основной файл** | `organize_downloads.ps1` |
| **Платформа** | Windows (PowerShell 5.x / PowerShell Core) |
| **Язык** | PowerShell |

---

## 2. Цели проекта

- Разгрузить корень папки «Загрузки» от большого количества разнородных файлов.
- Разложить файлы по категориям без ручного перетаскивания.
- Выделить экспорты чатов (Google, Gemini, GPT и т.п.) в отдельную папку `chat_export` по имени файла.
- Сохранить все файлы (без перезаписи): при совпадении имён добавляется суффикс `_1`, `_2` и т.д.
- Корректно обрабатывать имена с кириллицей за счёт установки кодировки UTF-8.

---

## 3. Требования к среде

- **ОС:** Windows (проверялось на Windows 10/11).
- **PowerShell:** встроенный Windows PowerShell или PowerShell 7+.
- **Права:** чтение и запись в целевую папку (`%USERPROFILE%\Downloads`).
- **Зависимости:** сторонние модули не используются.

---

## 4. Структура проекта

```
organize-downloads/
├── organize_downloads.ps1   # основной исполняемый скрипт
├── MANIFEST.md              # манифест (полное описание и документация)
├── README.md                 # краткое описание и запуск
├── LICENSE                   # лицензия MIT
└── .gitignore                # исключения для Git
```

---

## 5. Полное описание скрипта

Скрипт один раз за запуск обрабатывает **только файлы в корне** папки «Загрузки» текущего пользователя. Вложенные папки не обходятся и не изменяются.

**Что делает по шагам:**

1. Включает кодировку UTF-8 для вывода и консоли (корректные русские имена).
2. Определяет целевую папку: `%USERPROFILE%\Downloads`.
3. Создаёт в ней подпапки по списку категорий (если их ещё нет).
4. Собирает все файлы в корне «Загрузок», кроме `desktop.ini`.
5. Для каждого файла:
   - **Особое правило для .md:** если в имени файла (без учёта регистра) есть одно из слов: `google`, `gemini`, `gpt`, `chat` — файл переносится в папку **chat_export**. Остальные .md идут в **Documents** по расширению.
   - Остальные файлы распределяются по **расширению** по таблице категорий ниже; что не подошло — в **Other**.
6. При совпадении имени в папке назначения к имени без расширения добавляется `_1`, `_2`, … до свободного имени (перезапись не выполняется).
7. В конец выводится сообщение о списке папок.

**Что скрипт не делает:** не перемещает и не удаляет существующие подпапки в «Загрузках», не обрабатывает файлы внутри них.

---

## 6. Конфигурация

### 6.1. Целевая папка

В скрипте задаётся так:

```powershell
$base = Join-Path $env:USERPROFILE "Downloads"
```

Чтобы сортировать другую папку, замените `$base` в начале скрипта на нужный путь (строка или `Join-Path` к другой папке).

### 6.2. Категории по расширениям

Соответствие «папка → расширения» задаётся хешем `$folders` в скрипте:

| Папка | Расширения |
|-------|------------|
| **Installers** | `.exe`, `.msi` |
| **Images** | `.png`, `.jpg`, `.jpeg`, `.gif`, `.webp`, `.bmp`, `.ico` |
| **Videos** | `.mp4`, `.mkv`, `.avi`, `.mov`, `.wmv`, `.webm` |
| **Audio** | `.mp3`, `.wav`, `.flac`, `.m4a`, `.ogg` |
| **Archives** | `.zip`, `.7z`, `.rar`, `.tar`, `.gz` |
| **Documents** | `.txt`, `.xlsx`, `.xls`, `.pdf`, `.docx`, `.doc`, `.md` |
| **chat_export** | *(не по расширению)* — только .md с в имени: google, gemini, gpt, chat |
| **Other** | все остальные расширения (и файлы без расширения) |

Добавление новой категории по расширению: добавить запись в `$folders` (массив расширений). Логика цикла уже поддерживает произвольный набор категорий.

### 6.3. Правило для chat_export

В скрипте проверка задаётся так:

```powershell
if ($ext -eq ".md" -and $file.Name -imatch "google|gemini|gpt|chat")
```

- Учитываются только файлы с расширением `.md`.
- В **полном имени файла** (включая расширение) ищется подстрока `google`, `gemini`, `gpt` или `chat` (**без учёта регистра**).
- При совпадении файл переносится в папку **chat_export**; при несовпадении .md обрабатывается как обычный документ и попадает в **Documents**.

Изменить список слов или добавить другие расширения для «чатов» можно, отредактировав это условие и при необходимости отдельный цикл переноса.

---

## 7. Алгоритм работы (подробно)

1. **Кодировка**  
   `$OutputEncoding` и `[Console]::OutputEncoding` устанавливаются в UTF-8.

2. **Инициализация пути**  
   `$base = Join-Path $env:USERPROFILE "Downloads"`, переход в `$base` (`Set-Location`).

3. **Создание папок**  
   Для каждого ключа из `$folders` создаётся подпапка `$base\<Имя_категории>`, если её ещё нет.

4. **Сбор файлов**  
   `Get-ChildItem -Path $base -File`, исключается `desktop.ini`. Вложенные каталоги не перебираются.

5. **Обработка каждого файла**  
   - Расширение: `$ext = $file.Extension.ToLowerInvariant()`.  
   - **Шаг A (особое правило):** если `$ext -eq ".md"` и `$file.Name -imatch "google|gemini|gpt|chat"` — перенос в `chat_export` с проверкой на существующий файл и суффиксом `_1`, `_2`, …; переход к следующему файлу.  
   - **Шаг B (по расширению):** перебор категорий из `$folders`, кроме `Other` и `chat_export`. Если `$ext` входит в массив расширений категории — перенос в соответствующую папку (с той же логикой уникального имени); переход к следующему файлу.  
   - **Шаг C:** если файл никуда не отнесён — перенос в **Other** с той же логикой уникального имени.

6. **Завершение**  
   В консоль выводится строка со списком папок: Installers, Images, Videos, Audio, Archives, Documents, chat_export, Other.

**Важно:** существующие подпапки в «Загрузках» (например, `Telegram Desktop`, `gsd`) скрипт не перемещает и не изменяет.

---

## 8. Запуск

### 8.1. Из консоли PowerShell

```powershell
cd organize-downloads
.\organize_downloads.ps1
```

Если политика выполнения блокирует скрипты:

```powershell
powershell -ExecutionPolicy Bypass -File "organize-downloads\organize_downloads.ps1"
```

(Путь — относительно текущего каталога или полный путь к `organize_downloads.ps1`.)

### 8.2. Планировщик заданий Windows

Создайте задачу с действием:

- Программа: `powershell.exe`
- Аргументы: `-ExecutionPolicy Bypass -File "<полный_путь>\organize-downloads\organize_downloads.ps1"`

При необходимости укажите рабочую папку или полный путь к скрипту.

---

## 9. Безопасность и ограничения

- **Перезапись:** не выполняется; при совпадении имени генерируется новое с суффиксом `_1`, `_2`, …
- **Откат:** встроенного отката нет; при необходимости восстановить порядок нужен бэкап папки «Загрузки» до запуска.
- **Права:** скрипт не запрашивает повышенных прав; достаточно прав пользователя на целевую папку.
- **Символьные ссылки и junction:** обрабатываются как обычные объекты; при необходимости их можно исключить отдельной проверкой.
- **Ошибки:** при сбое `Move-Item` используется `-ErrorAction SilentlyContinue` — скрипт не падает, но сообщение об ошибке не выводится; для отладки можно заменить на `-ErrorAction Stop` или добавить логирование.

---

## 10. Результат выполнения

После запуска в папке «Загрузки» (`%USERPROFILE%\Downloads`) создаются (или уже есть) подпапки:

| Папка | Содержимое |
|-------|------------|
| **Installers** | установщики (.exe, .msi) |
| **Images** | изображения (.png, .jpg, …) |
| **Videos** | видео (.mp4, .mkv, …) |
| **Audio** | аудио (.mp3, .wav, .flac, .m4a, .ogg) |
| **Archives** | архивы (.zip, .7z, …) |
| **Documents** | документы и таблицы (.txt, .pdf, .docx, .md и т.д.), кроме .md для chat_export |
| **chat_export** | .md-файлы, в имени которых есть google, gemini, gpt или chat |
| **Other** | всё остальное (в т.ч. .pub, .pak и файлы без расширения) |

Уже существующие каталоги в «Загрузках» остаются на месте. Повторный запуск при пустом корне лишь создаёт/проверяет папки и завершается без переносов.

---

## 11. Возможные доработки

- Параметризация целевой папки и списка категорий через аргументы или конфиг-файл.
- Логирование перенесённых файлов (имя, откуда, куда) в текстовый лог.
- Режим «только показать, что будет перенесено» (dry-run) без реального перемещения.
- Рекурсивная обработка вложенных папок (с опцией и риском дублирования структуры).
- Исключение из переноса определённых имён или расширений (белый/чёрный список).
- Настраиваемый список слов для `chat_export` (например, из конфига или параметра).

---

## 12. История изменений (кратко)

- Первая версия: шесть категорий по расширениям, защита от перезаписи через суффиксы имён.
- Добавлена установка UTF-8 для корректной работы с кириллицей.
- Манифест и README добавлены для документирования.
- Проект вынесен в папку `organize-downloads`, добавлены LICENSE и .gitignore.
- Целевая папка переведена на `%USERPROFILE%\Downloads` (без жёсткого имени пользователя).
- Добавлена категория **Audio** (.mp3, .wav, .flac, .m4a, .ogg).
- Добавлена папка **chat_export** для .md-файлов с в имени словами google, gemini, gpt, chat.
- Полное описание скрипта и документация обновлены в MANIFEST.

---

*Документ: манифест проекта Organize Downloads. Файл: `MANIFEST.md`.*
